# 第 16 章　并发标记

- ConcurrentMark 类
- CMBitMap类
- ConcurrentMarkThread 类
- concurrentMarkThread.cpp

## 并发标记过

并发标记过程大致可以分为以下 5 个步骤。

- ①初始标记阶段
- ②并发标记阶段
- ③最终标记阶段
- ④存活对象计数
- ⑤收尾工作

①是进行根扫描的步骤。这一步骤是在安全点上执行的。

②是对①中标记出来的对象进行扫描的步骤。这一步骤与 mutator 并发执行，而且在多个线程上并行执行。

③是对②中没有标记完的对象进行扫描的步骤。这一步骤也是在安全点上执行，而且在多个线程上并行执行。

④是计算各个区域中被标记的对象的字节数的步骤。这一步骤与mutator 并发执行，而且在多个线程上并行执行。

⑤是对这次标记阶段进行收尾，并为下一次标记做准备的步骤。这一步骤也在安全点上执行，而且也在多个线程上并行执行。

## 根

- HotSpotVM 中可以作为根的对象大致有以下几类。
- 各线程特有的信息（栈帧等）
- 内置类
- JNI处理器
- 从常驻内存空间到其他内存空间的引用
- 转移专用记忆集合
- 其他

