# 第 2 章　并发标记

- 并发标记的主要作用是提供转移过程所需要的信息
- 标记位图
- TAMS是`Top At Marking Start`（标记开始时的top）的缩写
- 根扫描

## 并发标记

在简单标记中，所有可从根直接触达的对象都会被添加标记。带标记的是存活对象，不带标记的是死亡对象

需要注意的是，并发标记其实并不是直接在对象上添加标记，而是在`标记位图`上添加标记。标记位图：将用于标记的比特值等信息单独拿出来放到其他地方，用来匹配对应的对象

并发标记过程包括以下 5 个步骤:

- ①初始标记阶段
- ②并发标记阶段
- ③最终标记阶段
- ④存活对象计数
- ⑤收尾工作


为了防止在根扫描的过程中根被修改，在这个过程中 mutator 是暂停执行的。虽然 G1GC 中采用的写屏障技术可以获知对象的修改，但是大多数根并不是对象，它们的修改并不能被写屏障获知，因此在进行根扫描时必须暂停 mutator 的执行。

根需要频繁修改，所以其中大部分不在写屏障可以获知的范围内。也许G1GC 的设计者认为，与其频繁地通过写屏障去获知修改的方式，还不如直接暂停 mutator 来进行根扫描的方式性能更佳。
