# 第5章 盛放记录的大盒子-InnoDB数据页结构

- 存放表空间头部信息的页
- 存放 Insert Buffer信息的页
- 存放 INODE 信息的页
- 存放 undo 日志信息的页
- 存放记录的页为索引（INDEX）页 (数据页)
- 删除标记 delete_mask
- B+树
- 页子节点 + 非页子节点
- next_record 下一个主键记录的偏移
- Page Directory（页目录）
- Page Header（页面头部）
- File Header（文件头部）
- File Trailer


1. InnoDB为了不同的目的而设计了不同类型的页，我们把用于存放记录的页叫做 数据页。 
2. 一个数据页可以被大致划分为7个部分，分别是
- File Header ，表示页的一些通用信息，占固定的38字节。
- Page Header ，表示数据页专有的一些信息，占固定的56个字节。
- Infimum + Supremum ，两个虚拟的伪记录，分别表示页中的最小和最大记录，占固定的 26 个字节。
- User Records ：真实存储我们插入的记录的部分，大小不固定。
- Free Space ：页中尚未使用的部分，大小不确定。
- Page Directory ：页中的某些记录相对位置，也就是各个槽在页面中的地址偏移量，大小不固定，插入的记录越多，这个部分占用的空间越多。
- File Trailer ：用于检验页是否完整的部分，占用固定的8个字节。

3. 每个记录的头信息中都有一个 next_record 属性，从而使页中的所有记录串联成一个 单链表 。 
4. InnoDB 会为把页中的记录划分为若干个组，每个组的最后一个记录的地址偏移量作为一个 槽 ，存放在Page Directory 中，所以在一个页中根据主键查找记录是非常快的，分为两步：通过二分法确定该记录所在的槽。通过记录的next_record属性遍历该槽所在的组中的各个记录。
5. 每个数据页的 File Header 部分都有上一个和下一个页的编号，所以所有的数据页会组成一个 双链表 。 
6. 为保证从内存中同步到磁盘的页的完整性，在页的首部和尾部都会存储页中数据的校验和和页面最后修改时对应的 LSN 值，如果首部和尾部的校验和和 LSN 值校验不成功的话，就说明同步过程出现了问题。

## MySQL 页结构

![MySQL-page.drawio.svg](./images/MySQL-page.drawio.svg)
