# Traceroute 程序

由 VanJacobson 编写的 Traceroute 程序是一个能更深入探索 TCP/IP 协议的方便可用的工具。
尽管不能保证从源端发往目的端的两份连续的 IP 数据报具有相同的路由，但是大多数情况下
是这样的。Traceroute 程序可以让我们看到 IP 数据报从一台主机传到另一台主机所经过的路由。
Traceroute 程序还可以让我们使用 IP 源路由选项。

- TTL
- Traceroute
- IP 路由
- IP 源站选路选项

> 特点

Traceroute 程序使用 ICMP 报文和 IP 首部中的 TTL 字段（生存周期）。TTL 字段是由发送端
初始设置一个 8bit 字段。推荐的初始值由分配数字 RFC 指定，当前值为 64。较老版本的系统
经常初始化为 15 或 32。我们从第 7 章中的一些 ping 程序例子中可以看出，发送 ICMP 回显应答
时经常把 TTL 设为最大值 255。
每个处理数据报的路由器都需要把 TTL 的值减 1 或减去数据报在路由器中停留的秒数。由
于大多数的路由器转发数据报的时延都小于 1 秒钟，因此 TTL 最终成为一个跳站的计数器，所
经过的每个路由器都将其值减 1。

> 作用

Traceroute 程序可以让我们看到 IP 数据报从一台主机传到另一台主机所经过的路由。
Traceroute 程序还可以让我们使用 IP 源路由选项。

> 实现思路

我们现在可以猜想一下 Traceroute 程序的操作过程。它发送一份 TTL 字段为 1 的 IP 数据报给
目的主机。处理这份数据报的第一个路由器将 TTL 值减 1，丢弃该数据报，并发回一份超时
ICMP 报文。这样就得到了该路径中的第一个路由器的地址。然后 Traceroute 程序发送一份
TTL 值为 2 的数据报，这样我们就可以得到第二个路由器的地址。继续这个过程直至该数据报
到达目的主机。

TTL 字段的目的是防止数据报在选路时无休止地在网络中流动。例如，当路由器瘫痪或
者两个路由器之间的连接丢失时，选路协议有时会去检测丢失的路由并一直进行下去。在这
段时间内，数据报可能在循环回路被终止。TTL 字段就是在这些循环传递的数据报上加上一
个生存上限。
