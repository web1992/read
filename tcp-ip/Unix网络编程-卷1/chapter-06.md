# ç¬¬6ç«  I/O å¤ç”¨ select å’Œ poll å‡½æ•°

å…³é”®å­—ï¼š

- é˜»å¡å¼ I/O;
- éé˜»å¡å¼ I/O;
- I/O å¤ç”¨(selec å’Œ poll)
- ä¿¡å·é©±åŠ¨å¼ I/O( SIGIO);
- å¼‚æ­¥ I/O(POSX çš„ aio\_ç³»åˆ—å‡½æ•°)ã€‚
- I/O æ¨¡å‹å¯¹æ¯”
- åŒæ­¥ I/O æ“ä½œ
- å¼‚æ­¥ I/O æ“ä½œ
- select å‡½æ•°
- pselect å‡½æ•°
- poll å‡½æ•°

## æ¦‚è¿°

åœ¨ 5.12 èŠ‚ä¸­,æˆ‘ä»¬çœ‹åˆ° TCP å®¢æˆ·åŒæ—¶å¤„ç†ä¸¤ä¸ªè¾“å…¥:æ ‡å‡†è¾“å…¥å’Œ TCP å¥—æ¥å­—ã€‚æˆ‘ä»¬é‡åˆ°çš„é—®é¢˜æ˜¯å°±åœ¨å®¢æˆ·é˜»å¡äº(æ ‡å‡†è¾“å…¥ä¸Šçš„) fgets è°ƒç”¨æœŸé—´,æœåŠ¡å™¨è¿›ç¨‹ä¼šè¢«æ€æ­»ã€‚æœåŠ¡å™¨ TCP è™½ç„¶æ­£ç¡®åœ°ç»™å®¢æˆ· TCP å‘é€äº†ä¸€ä¸ª FIN,ä½†æ˜¯æ—¢ç„¶å®¢æˆ·è¿›ç¨‹æ­£é˜»å¡äºä»æ ‡å‡†è¾“å…¥è¯»å…¥çš„è¿‡ç¨‹,å®ƒå°†çœ‹ä¸åˆ°è¿™ä¸ªEOF,ç›´åˆ°ä»å¥—æ¥å­—è¯»æ—¶ä¸ºæ­¢(å¯èƒ½å·²è¿‡äº†å¾ˆé•¿æ—¶é—´)ã€‚

è¿™æ ·çš„è¿›ç¨‹éœ€è¦ä¸€ç§é¢„å…ˆå‘ŠçŸ¥å†…æ ¸çš„èƒ½åŠ›,ä½¿å¾—å†…æ ¸ä¸€æ—¦å‘ç°è¿›ç¨‹æŒ‡å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ª IO æ¡ä»¶å°±ç»ª(ä¹Ÿå°±æ˜¯è¯´è¾“å…¥å·²å‡†å¤‡å¥½è¢«
è¯»å–,æˆ–è€…æè¿°ç¬¦å·²èƒ½æ‰¿æ¥æ›´å¤šçš„è¾“å‡º),å®ƒå°±é€šçŸ¥è¿›ç¨‹ã€‚è¿™ä¸ªèƒ½åŠ›ç§°ä¸º IO å¤ç”¨(IOmultiplexing),
æ˜¯ç”± select å’Œ poll è¿™ä¸¤ä¸ªå‡½æ•°æ”¯æŒçš„ã€‚æˆ‘ä»¬è¿˜ä»‹ç»å‰è€…è¾ƒæ–°çš„ç§°ä¸º select çš„ POSIX å˜ç§ã€‚

## 5 ç§ I/O æ¨¡å‹:

åœ¨ä»‹ç» selec å’Œ poll è¿™ä¸¤ä¸ªå‡½æ•°ä¹‹å‰,æˆ‘ä»¬éœ€è¦å›é¡¾æ•´ä½“,æŸ¥çœ‹ Unâ…¸ ä¸‹å¯ç”¨çš„ 5 ç§ I/O æ¨¡å‹çš„åŸºæœ¬åŒºåˆ«:

- é˜»å¡å¼ I/O;
- éé˜»å¡å¼ I/O;
- I/O å¤ç”¨(selec å’Œ poll)
- ä¿¡å·é©±åŠ¨å¼ I/O(SIGIO);
- å¼‚æ­¥ I/O(POSX çš„ aio\_ç³»åˆ—å‡½æ•°)ã€‚

æ­£å¦‚æˆ‘ä»¬å°†åœ¨æœ¬èŠ‚ç»™å‡ºçš„æ‰€æœ‰ä¾‹å­æ‰€ç¤º,ä¸€ä¸ªè¾“å…¥æ“ä½œé€šå¸¸åŒ…æ‹¬ä¸¤ä¸ªä¸åŒçš„é˜¶æ®µ
(1)ç­‰å¾…æ•°æ®å‡†å¤‡å¥½;
(2)ä»å†…æ ¸å‘è¿›ç¨‹å¤åˆ¶æ•°æ®ã€‚

å¯¹äºä¸€ä¸ªå¥—æ¥å­—ä¸Šçš„è¾“å…¥æ“ä½œ,
ç¬¬ä¸€æ­¥é€šå¸¸æ¶‰åŠç­‰å¾…æ•°æ®ä»ç½‘ç»œä¸­åˆ°è¾¾ã€‚å½“æ‰€ç­‰å¾…åˆ†ç»„åˆ°è¾¾æ—¶,å®ƒè¢«å¤åˆ¶åˆ°å†…æ ¸ä¸­çš„æŸä¸ªç¼“å†²åŒºã€‚
ç¬¬äºŒæ­¥å°±æ˜¯æŠŠæ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºã€‚

> ğŸ¶ç†è§£ä¸Šé¢è¿™å¥è¯éå¸¸é‡è¦ğŸ¶

## recvfrom å‡½æ•°

åœ¨æœ¬èŠ‚çš„ä¾‹å­ä¸­,æˆ‘ä»¬æŠŠ recvfrom å‡½æ•°è§†ä¸ºç³»ç»Ÿè°ƒç”¨,å› ä¸ºæˆ‘ä»¬æ­£åœ¨åŒºåˆ†åº”ç”¨è¿›ç¨‹å’Œå†…æ ¸ã€‚
ä¸è®ºå®ƒå¦‚ä½•å®ç°ä¸€èˆ¬éƒ½ä¼šä»åœ¨åº”ç”¨è¿›ç¨‹ç©ºé—´ä¸­è¿è¡Œåˆ‡æ¢åˆ°åœ¨å†…æ ¸ç©ºé—´ä¸­è¿è¡Œ,ä¸€æ®µæ—¶é—´ä¹‹åå†åˆ‡æ¢å›æ¥ã€‚

è¿›ç¨‹è°ƒç”¨recvfrom,å…¶ç³»ç»Ÿè°ƒç”¨ç›´åˆ°æ•°æ®æŠ¥åˆ°è¾¾ä¸”è¢«å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹çš„ç¼“å†²åŒºä¸­æˆ–è€…å‘ç”Ÿé”™è¯¯æ‰è¿”å›ã€‚æœ€å¸¸è§çš„é”™è¯¯æ˜¯ç³»ç»Ÿè°ƒç”¨è¢«ä¿¡å·ä¸­æ–­ã€‚
æˆ‘ä»¬è¯´è¿›ç¨‹åœ¨ä»è°ƒç”¨ recvfrom å¼€å§‹åˆ°å®ƒè¿”å›çš„æ•´æ®µæ—¶é—´å†…æ˜¯è¢«é˜»å¡çš„ã€‚recvfrom æˆåŠŸè¿”å›å,åº”ç”¨è¿›ç¨‹å¼€å§‹å¤„ç†æ•°æ®æŠ¥ã€‚

## é˜»å¡å¼ I/O æ¨¡å‹

> å›¾ 6-1 é˜»å¡å¼ I/O æ¨¡å‹

![unix-network-1-6-1.svg](./images/unix-network-1-6-1.svg)

ä»**ç­‰å¾…æ•°æ®å‡†å¤‡å¥½** -> **å°†ä»å†…æ ¸å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´**éƒ½æ˜¯é˜»å¡çš„ã€‚

## éé˜»å¡å¼ I/O æ¨¡å‹

è¿›ç¨‹æŠŠä¸€ä¸ªå¥—æ¥å­—**è®¾ç½®æˆéé˜»å¡**æ˜¯åœ¨é€šçŸ¥å†…æ ¸:å½“æ‰€è¯·æ±‚çš„ IO æ“ä½œéå¾—æŠŠæœ¬è¿›ç¨‹æŠ•å…¥ç¡çœ 
æ‰èƒ½å®Œæˆæ—¶,ä¸è¦æŠŠæœ¬è¿›ç¨‹æŠ•å…¥ç¡çœ ,è€Œæ˜¯è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚

å‰ä¸‰æ¬¡è°ƒç”¨ recvfrom æ—¶æ²¡æœ‰æ•°æ®å¯è¿”å›,å› æ­¤å†…æ ¸è½¬è€Œç«‹å³è¿”å›ä¸€ä¸ª `EWOULDBLOCK` é”™è¯¯ã€‚
ç¬¬å››æ¬¡è°ƒç”¨ recvfrom æ—¶å·²æœ‰ä¸€ä¸ªæ•°æ®æŠ¥å‡†å¤‡å¥½,å®ƒè¢«å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒº,äºæ˜¯ recvfromæˆåŠŸè¿”å›ã€‚æˆ‘ä»¬æ¥ç€å¤„ç†æ•°æ®ã€‚
å½“ä¸€ä¸ªåº”ç”¨è¿›ç¨‹åƒè¿™æ ·å¯¹ä¸€ä¸ªéé˜»å¡æè¿°ç¬¦å¾ªç¯è°ƒç”¨ recvfrom æ—¶,æˆ‘ä»¬ç§°ä¹‹ä¸ºè½®è¯¢polling)ã€‚åº”ç”¨è¿›ç¨‹æŒç»­è½®è¯¢å†…æ ¸,ä»¥æŸ»çœ‹æŸä¸ªæ“ä½œæ˜¯å¦å°±ç»ªã€‚
è¿™ä¹ˆåšå¾€å¾€è€—è´¹å¤§é‡ CPU æ—¶é—´ä¸è¿‡è¿™ç§æ¨¡å‹å¶å°”ä¹Ÿä¼šé‡åˆ°,é€šå¸¸æ˜¯åœ¨ä¸“é—¨æä¾›æŸä¸€ç§åŠŸèƒ½çš„ç³»ç»Ÿä¸­æ‰æœ‰ã€‚

> å›¾ 6-2 éé˜»å¡å¼ I/O æ¨¡å‹

![unix-network-1-6-2.svg](./images/unix-network-1-6-2.svg)

## I/O å¤ç”¨æ¨¡å‹

æœ‰äº† I/O å¤ç”¨( I/O multiplexing),æˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨ select æˆ– poll,é˜»å¡åœ¨è¿™ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ä¸­çš„æŸä¸€ä¸ªä¹‹ä¸Š,è€Œä¸æ˜¯é˜»å¡åœ¨çœŸæ­£çš„ I/O ç³»ç»Ÿè°ƒç”¨ä¸Šã€‚å›¾ 6-3 æ¦‚æ‹¬å±•ç¤ºäº† I/O å¤ç”¨æ¨¡å‹ã€‚

> å›¾ 6-3 I/O å¤ç”¨æ¨¡å‹

![unix-network-1-6-3.svg](./images/unix-network-1-6-3.svg)

æˆ‘ä»¬é˜»å¡äº select è°ƒç”¨,ç­‰å¾…æ•°æ®æŠ¥å¥—æ¥å­—å˜ä¸ºå¯è¯»ã€‚å½“ select è¿”å›å¥—æ¥å­—å¯è¯»è¿™ä¸€æ¡ä»¶
æ—¶,æˆ‘ä»¬è°ƒç”¨ recvfrom æŠŠæ‰€è¯»æ•°æ®æŠ¥å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºã€‚

æ¯”è¾ƒå›¾ 6-3 å’Œå›¾ 6-1,I/O å¤ç”¨å¹¶ä¸æ˜¾å¾—æœ‰ä»€ä¹ˆä¼˜åŠ¿,äº‹å®ä¸Šç”±äºä½¿ç”¨ select éœ€è¦ä¸¤ä¸ªè€Œä¸æ˜¯å•ä¸ªç³»ç»Ÿè°ƒç”¨,I/O å¤ç”¨è¿˜ç¨æœ‰åŠ£åŠ¿ã€‚
ä¸è¿‡æˆ‘ä»¬å°†åœ¨æœ¬ç« ç¨åçœ‹åˆ°,ä½¿ç”¨ select çš„ä¼˜åŠ¿åœ¨äºæˆ‘ä»¬å¯ä»¥ç­‰å¾…å¤šä¸ªæè¿°ç¬¦å°±ç»ªã€‚

```txt
ä¸I/Oå¤ç”¨å¯†åˆ‡ç›¸å…³çš„å¦ä¸€ç§I/Oæ¨¡å‹æ˜¯åœ¨å¤šçº¿ç¨‹ä¸­ä½¿ç”¨é˜»å¡å¼I/O.è¿™ç§æ¨¡å‹ä¸ä¸Šè¿°æ¨¡å‹æä¸ºç›¸ä¼¼,
ä½†å®ƒæ²¡æœ‰ä½¿ç”¨selecté˜»å¡åœ¨å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸Š,è€Œæ˜¯ä½¿ç”¨å¤šä¸ªçº¿ç¨‹(æ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸€ä¸ªçº¿ç¨‹),è¿™æ ·æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥è‡ªç”±åœ°è°ƒç”¨è¯¸å¦‚ recvfrom ä¹‹ç±»çš„é˜»å¡å¼I/Oç³»ç»Ÿè°ƒç”¨äº†ã€‚
```

## ä¿¡å·é©±åŠ¨å¼ I/O æ¨¡å‹

æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ä¿¡å·,è®©å†…æ ¸åœ¨æè¿°ç¬¦å°±ç»ªæ—¶å‘é€ SIGIO ä¿¡å·é€šçŸ¥æˆ‘ä»¬ã€‚æˆ‘ä»¬ç§°è¿™ç§æ¨¡å‹ä¸ºä¿¡å·é©±åŠ¨å¼ I/O(signal-driven I/O),å›¾ 6-4 æ˜¯å®ƒçš„æ¦‚è¦å±•ç¤º

> å›¾ 6-4 ä¿¡å·é©±åŠ¨å¼ I/O æ¨¡å‹

![unix-network-1-6-4.svg](./images/unix-network-1-6-4.svg)

æˆ‘ä»¬é¦–å…ˆå¼€å¯å¥—æ¥å­—çš„ä¿¡å·é©±åŠ¨å¼ IO åŠŸèƒ½(æˆ‘ä»¬å°†åœ¨ 252 èŠ‚è®²è§£è¿™ä¸ªè¿‡ç¨‹),å¹¶é€šè¿‡
`sigaction` ç³»ç»Ÿè°ƒç”¨å®‰è£…ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ã€‚è¯¥ç³»ç»Ÿè°ƒç”¨å°†ç«‹å³è¿”å›,æˆ‘ä»¬çš„è¿›ç¨‹ç»§ç»­å·¥ä½œ,
ä¹Ÿå°±æ˜¯è¯´å®ƒæ²¡æœ‰è¢«é˜»å¡ã€‚å½“æ•°æ®æŠ¥å‡†å¤‡å¥½è¯»å–æ—¶,å†…æ ¸å°±ä¸ºè¯¥è¿›ç¨‹äº§ç”Ÿä¸€ä¸ª SIGIO ä¿¡å·ã€‚
æˆ‘ä»¬éšåæ—¢å¯ä»¥åœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­è°ƒç”¨ recvfrom è¯»å–æ•°æ®æŠ¥,å¹¶é€šçŸ¥ä¸»å¾ªç¯æ•°æ®å·²å‡†å¤‡å¥½å¾…å¤„ç†
(è¿™æ­£æ˜¯æˆ‘ä»¬å°†åœ¨ 253 èŠ‚ä¸­æ‰€è¦åšçš„äº‹æƒ…),ä¹Ÿå¯ä»¥ç«‹å³é€šçŸ¥ä¸»å¾ªç¯,è®©å®ƒè¯»å–æ•°æ®æŠ¥ã€‚

æ— è®ºå¦‚ä½•å¤„ç† SIGIO ä¿¡å·,è¿™ç§æ¨¡å‹çš„ä¼˜åŠ¿åœ¨äºç­‰å¾…æ•°æ®æŠ¥åˆ°è¾¾æœŸé—´è¿›ç¨‹ä¸è¢«é˜»å¡ã€‚
ä¸»å¾ªç¯å¯ä»¥ç»§ç»­æ‰§è¡Œ,åªè¦ç­‰å¾…æ¥è‡ªä¿¡å·å¤„ç†å‡½æ•°çš„é€šçŸ¥:æ—¢å¯ä»¥æ˜¯æ•°æ®å·²å‡†å¤‡å¥½è¢«å¤„ç†,ä¹Ÿå¯ä»¥æ˜¯æ•°æ®æŠ¥å·²å‡†å¤‡å¥½è¢«è¯»å–ã€‚

## å¼‚æ­¥ I/O æ¨¡å‹

å¼‚æ­¥ I/O( asynchronous I/O)ç”± POSX è§„èŒƒå®šä¹‰ã€‚æ¼”å˜æˆå½“å‰ POSX è§„èŒƒçš„å„ç§æ—©æœŸæ ‡å‡†æ‰€å®šä¹‰çš„å®æ—¶å‡½æ•°ä¸­å­˜åœ¨çš„å·®å¼‚å·²ç»å–å¾—ä¸€è‡´ã€‚

ä¸€èˆ¬åœ°è¯´,è¿™äº›å‡½æ•°çš„å·¥ä½œæœºåˆ¶æ˜¯:å‘ŠçŸ¥å†…æ ¸å¯åŠ¨æŸä¸ªæ“ä½œ,å¹¶è®©å†…æ ¸åœ¨æ•´ä¸ªæ“ä½œ(åŒ…æ‹¬å°†æ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°æˆ‘ä»¬è‡ªå·±çš„ç¼“å†²åŒº)å®Œæˆåé€šçŸ¥æˆ‘ä»¬ã€‚
è¿™ç§æ¨¡å‹ä¸å‰ä¸€èŠ‚ä»‹ç»çš„ä¿¡å·é©±åŠ¨æ¨¡å‹çš„ä¸»è¦åŒºåˆ«åœ¨äº:ä¿¡å·é©±åŠ¨å¼ IO æ˜¯ç”±å†…æ ¸é€šçŸ¥æˆ‘ä»¬ä½•æ—¶å¯ä»¥å¯åŠ¨ä¸€ä¸ª I/O æ“ä½œ,è€Œå¼‚æ­¥ I/O æ¨¡å‹æ˜¯ç”±å†…æ ¸é€šçŸ¥æˆ‘ä»¬ I/O æ“ä½œä½•æ—¶å®Œæˆã€‚
å›¾ 6-5 ç»™å‡ºäº†ä¸ªä¾‹å­ã€‚

> å›¾ 6-5 å¼‚æ­¥ I/O æ¨¡å‹

![unix-network-1-6-5.svg](./images/unix-network-1-6-5.svg)

æˆ‘ä»¬è°ƒç”¨ `aio_read` å‡½æ•°(POSX å¼‚æ­¥ I/O å‡½æ•°ä»¥ aio\_æˆ– lio å¼€å¤´),ç»™å†…æ ¸ä¼ é€’æè¿°ç¬¦ã€ç¼“
å†²åŒºæŒ‡é’ˆã€ç¼“å†²åŒºå¤§å°(ä¸ read ç›¸åŒçš„ä¸‰ä¸ªå‚æ•°)å’Œæ–‡ä»¶åç§»(ä¸ lseek ç±»ä¼¼),å¹¶å‘Šè¯‰å†…æ ¸å½“æ•´ä¸ªæ“ä½œå®Œæˆæ—¶å¦‚ä½•é€šçŸ¥æˆ‘ä»¬ã€‚è¯¥ç³»ç»Ÿè°ƒç”¨ç«‹å³è¿”å›,è€Œä¸”åœ¨ç­‰å¾… I/O å®ŒæˆæœŸé—´,æˆ‘ä»¬çš„è¿›ç¨‹ä¸è¢«é˜»å¡ã€‚æœ¬ä¾‹å­ä¸­æˆ‘ä»¬å‡è®¾è¦æ±‚å†…æ ¸åœ¨æ“ä½œå®Œæˆæ—¶äº§ç”ŸæŸä¸ªä¿¡å·ã€‚è¯¥ä¿¡å·ç›´åˆ°æ•°æ®å·²å¤åˆ¶åˆ°åº”ç”¨è¿›ç¨‹ç¼“å†²åŒºæ‰äº§ç”Ÿ,è¿™ä¸€ç‚¹ä¸åŒäºä¿¡å·é©±åŠ¨å¼ I/O æ¨¡å‹ã€‚

```txt
æœ¬ä¹¦ç¼–å†™è‡³æ­¤çš„æ—¶å€™,æ”¯æŒ POSâ…¨ å¼‚æ­¥ I/O æ¨¡å‹çš„ç³»ç»Ÿä»è¾ƒç½•è§ã€‚æˆ‘ä»¬ä¸èƒ½ç¡®å®šè¿™æ ·çš„ç³»
ç»Ÿæ˜¯å¦æ”¯æŒå¥—æ¥å­—ä¸Šçš„è¿™ç§æ¨¡å‹ã€‚è¿™å„¿æˆ‘ä»¬åªæ˜¯ç”¨å®ƒä½œä¸ºä¸€ä¸ªä¸ä¿¡å·é©±åŠ¨å¼ I/O æ¨¡å‹ç›¸æ¯”ç…§çš„ä¾‹å­ã€‚
```

## I/O æ¨¡å‹å¯¹æ¯”

å›¾ 6-6 å¯¹æ¯”äº†ä¸Šè¿° 5 ç§ä¸åŒçš„ I/O æ¨¡å‹ã€‚å¯ä»¥çœ‹å‡º,å‰ 4 ç§æ¨¡å‹çš„ä¸»è¦åŒºåˆ«åœ¨äºç¬¬ä¸€é˜¶æ®µ,å› ä¸ºå®ƒä»¬çš„ç¬¬äºŒé˜¶æ®µæ˜¯ä¸€æ ·çš„:åœ¨æ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°è°ƒç”¨è€…çš„ç¼“å†²åŒºæœŸé—´,è¿›ç¨‹é˜»å¡äº recvfrom è°ƒç”¨ã€‚
ç›¸å,å¼‚æ­¥ IO æ¨¡å‹åœ¨è¿™ä¸¤ä¸ªé˜¶æ®µéƒ½è¦å¤„ç†,ä»è€Œä¸åŒäºå…¶ä»– 4 ç§æ¨¡å‹ã€‚

> å›¾ 6-6 5 ç§ I/O æ¨¡å‹çš„æ¯”è¾ƒ

![unix-network-1-6-6.svg](./images/unix-network-1-6-6.svg)

POSIX æŠŠè¿™ä¸¤ä¸ªæœ¯è¯­å®šä¹‰å¦‚ä¸‹:

- åŒæ­¥ I/O æ“ä½œ( synchronous I/O opetation)å¯¼è‡´è¯·æ±‚è¿›ç¨‹é˜»å¡,ç›´åˆ° I/O æ“ä½œå®Œæˆ;
- å¼‚æ­¥ I/O æ“ä½œ( asynchronous I/O opetation)ä¸å¯¼è‡´è¯·æ±‚è¿›ç¨‹é˜»å¡ã€‚

æ ¹æ®ä¸Šè¿°å®šä¹‰,æˆ‘ä»¬çš„å‰ 4 ç§æ¨¡å‹â€”â€”`é˜»å¡å¼ I/O æ¨¡å‹`ã€`éé˜»å¡å¼ I/O æ¨¡å‹`ã€`I/O å¤ç”¨æ¨¡å‹`å’Œ`ä¿¡å·é©±åŠ¨å¼ I/O æ¨¡å‹`éƒ½æ˜¯åŒæ­¥ I/O æ¨¡å‹,
å› ä¸ºå…¶ä¸­çœŸæ­£çš„ I/O æ“ä½œ( recvfrom)å°†é˜»å¡è¿›ç¨‹ã€‚åªæœ‰`å¼‚æ­¥ I/O æ¨¡å‹`ä¸ POSIX å®šä¹‰çš„å¼‚æ­¥ I/O ç›¸åŒ¹é…ã€‚

## select å‡½æ•°

```c
#include <sys/select.h>
#include <sys/time.h>

//è¿”å›å€¼ï¼šå°±ç»ªæè¿°å­—çš„æ€»æ•°ç›®ï¼Œ0â€”â€”è¶…æ—¶ï¼Œ-1â€”â€”å‡ºé”™
int select(int maxfdpl, fd_set *readset, fd_set *writeset,fd_set *exceptset, const struct timeval *timeout);

struct timeval {
    time_t      tv_sec;         /* seconds */
    suseconds_t tv_usec;        /* microseconds */
};
```

## pselect å‡½æ•°

```c
#include <sys/select.h>
#include <signal.h>
#include <time.h>

// è¿”å›ï¼šå°±ç»ªæè¿°å­—çš„ä¸ªæ•°ï¼Œ0ï¼è¶…æ—¶ï¼Œ-1ï¼å‡ºé”™
int pselect(int maxfdp1, fd_set *readset, fd_set *writeset, fd_set *exceptset, const struct timespec *timeout, const sigset_t *sigmask);

struct timespec{
    time_t tv_sec;     //seconds
    long   tv_nsec;    //nanoseconds
};
```

## poll å‡½æ•°

```c
# include <poll.h>
int poll ( struct pollfd * fds, unsigned int nfds, int timeout);
```

## Links

- [é«˜çº§ I/O ä¹‹ I/O å¤šè·¯è½¬æ¥â€”â€”poolã€select](https://www.cnblogs.com/nufangrensheng/p/3557584.html)
- [selectã€pollã€epoll ä¹‹é—´çš„åŒºåˆ«æ€»ç»“[æ•´ç†]](https://www.cnblogs.com/Anker/p/3265058.html)
- [pselect å’Œ select](https://www.cnblogs.com/diegodu/p/3988103.html)
- [æ·±å…¥ç†è§£ Linux çš„ epoll æœºåˆ¶](https://mp.weixin.qq.com/s/LGMNEsWuXjDM7V9HlnxSuQ)
- [é«˜æ•ˆçš„ç½‘ç»œIOæ¨¡å‹](https://mp.weixin.qq.com/s/naGheZq_z5d8pyB_i9hY7g)